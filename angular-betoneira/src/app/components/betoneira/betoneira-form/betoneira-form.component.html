<mat-toolbar color="primary">
    <div class="toolbar-title">Registro de Betoneira</div>
</mat-toolbar>

<div class="betoneira-form-container">
    <mat-card>
        <mat-card-content>
            <form [formGroup]="formGroup" (ngSubmit)="salvar()">
                <div class="container">

                    <mat-form-field appearance="fill" class="full-width-input">
                        <mat-label>Nome da betoneira:</mat-label>
                        <input matInput type="text" id="nome" formControlName="nome" required>
                        <mat-error *ngIf="formGroup.get('nome')?.invalid && formGroup.get('nome')?.touched">
                            {{ getErrorMessage("nome", formGroup.get("nome")?.errors) }}
                        </mat-error>
                    </mat-form-field>

                    <mat-form-field appearance="fill" class="full-width-input">
                        <mat-label>Descrição:</mat-label>
                        <textarea matInput id="descricao" formControlName="descricao" required></textarea>
                        <mat-error *ngIf="formGroup.get('descricao')?.invalid && formGroup.get('descricao')?.touched">
                            {{ getErrorMessage("descricao", formGroup.get("descricao")?.errors) }}
                        </mat-error>
                    </mat-form-field>

                    <mat-form-field appearance="fill" class="full-width-input">
                        <mat-label>Preço:</mat-label>
                        <input matInput type="number" id="preco" formControlName="preco" required>
                        <mat-error *ngIf="formGroup.get('preco')?.invalid && formGroup.get('preco')?.touched">
                            {{ getErrorMessage("preco", formGroup.get("preco")?.errors) }}
                        </mat-error>
                    </mat-form-field>
                    
                    <mat-form-field appearance="fill" class="full-width-input">
                        <mat-label>Estoque:</mat-label>
                        <input matInput type="number" id="quantidadeEstoque" formControlName="quantidadeEstoque" required>
                        <mat-error *ngIf="formGroup.get('quantidadeEstoque')?.invalid && formGroup.get('quantidadeEstoque')?.touched">
                            {{ getErrorMessage("quantidadeEstoque", formGroup.get("quantidadeEstoque")?.errors) }}
                        </mat-error>
                    </mat-form-field>

                    <mat-form-field appearance="fill" class="full-width-input">
                        <mat-label>Modelo da betoneira:</mat-label>
                        <input matInput type="text" id="modelo" formControlName="modelo" required>
                        <mat-error *ngIf="formGroup.get('modelo')?.invalid && formGroup.get('modelo')?.touched">
                            {{ getErrorMessage("modelo", formGroup.get("modelo")?.errors) }}
                        </mat-error>
                    </mat-form-field>

                    <mat-form-field appearance="fill" class="full-width-input">
                        <mat-label>Marca da betoneira:</mat-label>
                        <input matInput type="text" id="marca" formControlName="marca" required>
                        <mat-error *ngIf="formGroup.get('marca')?.invalid && formGroup.get('marca')?.touched">
                            {{ getErrorMessage("marca", formGroup.get("marca")?.errors) }}
                        </mat-error>
                    </mat-form-field>
                    
                    <mat-form-field appearance="fill" class="full-width-input">
                        <mat-label>Capacidade da betoneira:</mat-label>
                        <input matInput type="number" id="capacidade" formControlName="capacidade" required>
                        <mat-error *ngIf="formGroup.get('capacidade')?.invalid && formGroup.get('capacidade')?.touched">
                            {{ getErrorMessage("capacidade", formGroup.get("capacidade")?.errors) }}
                        </mat-error>
                    </mat-form-field>
                    
                    <mat-form-field appearance="fill" class="full-width-input">
                        <mat-label>Tipo de betoneira:</mat-label>
                        <mat-select id="tipoBetoneira" formControlName="tipoBetoneira" required>
                            <mat-option *ngFor="let tipo of tipos" [value]="tipo.id">
                                {{ tipo.nome }}
                            </mat-option>
                        </mat-select>
                        <mat-error *ngIf="formGroup.get('tipoBetoneira')?.invalid && formGroup.get('tipoBetoneira')?.touched">
                            {{ getErrorMessage("tipoBetoneira", formGroup.get("tipoBetoneira")?.errors) }}
                        </mat-error>
                    </mat-form-field>

                    <mat-form-field appearance="fill" class="full-width-input">
                        <mat-label>Fabricante:</mat-label>
                        <mat-select id="idFabricante" formControlName="idFabricante" required>
                            <mat-option *ngFor="let fab of fabricantes" [value]="fab.id">
                                {{ fab.nome }}
                            </mat-option>
                        </mat-select>
                        <mat-error *ngIf="formGroup.get('idFabricante')?.invalid && formGroup.get('idFabricante')?.touched">
                            {{ getErrorMessage("idFabricante", formGroup.get("idFabricante")?.errors) }}
                        </mat-error>
                    </mat-form-field>

                    <mat-form-field appearance="outline" class="full-width-input">
                        <mat-label>Imagem da betoneira</mat-label>
                        <input type="file" (change)="carregarImagemSelecionada($event)" hidden #fileInput>
                        <input matInput [value]="fileName" readonly>
                        <button mat-icon-button matSuffix type="button" (click)="fileInput.click()">
                            <mat-icon>folder_open</mat-icon>
                        </button>
                    </mat-form-field>
                </div>

                <div *ngIf="imagePreview" class="betoneira-card">
                    <img class="betoneira-image" [src]="imagePreview" alt="Preview">
                    <div class="betoneira-details">
                        <mat-card-title class="centered-text">{{ formGroup.get("nome")?.value }}</mat-card-title>
                        <mat-card-content class="centered-text">
                            <h5>{{ formGroup.get("descricao")?.value }}</h5>
                            <h5>Fabricante: {{ fabricantes.find(f => f.id === formGroup.get("idFabricante")?.value)?.nome }}</h5>
                            <h5>Tipo: {{ tipos.find(t => t.name === formGroup.get("tipoBetoneira")?.value)?.nome }}</h5>
                            <h5>R$ {{ formGroup.get("preco")?.value }}</h5>
                        </mat-card-content>

                        <mat-card-actions class="centered-text">
                            <button mat-button color="primary">Ver mais ...</button>
                            <button mat-button color="accent">Adicionar ao carrinho</button>
                        </mat-card-actions>
                    </div>
                </div>

                <div class="container">
                    <mat-card-actions>
                        <button mat-raised-button routerLink="/admin/betoneira">Cancelar</button>

                        <button mat-raised-button *ngIf="formGroup.get('id')?.value" color="warn" (click)="excluir()" [disabled]="formGroup.invalid">
                            Excluir
                        </button>

                        <button mat-raised-button color="primary" type="submit">
                            Salvar
                        </button>
                    </mat-card-actions>
                </div>

            </form>
        </mat-card-content>
    </mat-card>
</div>
